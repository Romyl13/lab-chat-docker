# --- Етап 1: База ---
# Беремо готовий "чистий" образ (картинку) Linux з уже встановленим Python.
# 3.10-slim - це легка, мінімальна версія, що ідеально для сервера.
FROM python:3.10-slim

# --- Етап 2: Встановлення "робочого місця" ---
# Створюємо папку /app всередині контейнера. 
# Це буде наше "робоче місце".
WORKDIR /app

# --- Етап 3: Встановлення бібліотек ---
# Копіюємо ТІЛЬКИ "список покупок" (.txt) всередину.
# Чому тільки його? Docker розумний і кешує цей крок. 
# Якщо ми не міняли список, він не буде перевстановлювати все заново.
COPY moduls.txt .

# Запускаємо pip, щоб він встановив усе зі списку.
RUN pip install --no-cache-dir -r moduls.txt

# --- Етап 4: Копіювання коду ---
# Тепер, коли бібліотеки на місці, копіюємо решту нашого коду:
# chat.py, папку templ/ і т.д.
COPY . .

# --- Етап 5: Запуск! ---
# Це команда, яка виконається, коли контейнер СТАРТУЄ.
# Вона каже: "Запусти uvicorn, візьми 'app' з файлу 'chat', 
# і слухай на всіх IP-адресах ('0.0.0.0') на порту 8000".
# '0.0.0.0' - це критично важливо для Docker.
CMD ["uvicorn", "chat:app", "--host", "0.0.0.0", "--port", "8000"]